# ì¤‘ë³µ ì—…ë¬´ ê´€ë¦¬ UI êµ¬í˜„ ì™„ë£Œ

## ê°œìš”

admin/tasks í˜ì´ì§€ì— ì¤‘ë³µ ì—…ë¬´ ì¡°íšŒ ë° ì‚­ì œ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
ê¶Œí•œ ë ˆë²¨ 4 (ê´€ë¦¬ì)ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì‹œìŠ¤í…œì—ì„œ ì¤‘ë³µëœ ì—…ë¬´ë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## êµ¬í˜„ ì™„ë£Œ í•­ëª©

### 1. API ì—”ë“œí¬ì¸íŠ¸ (`app/api/admin/tasks/duplicates/route.ts`)

#### GET /api/admin/tasks/duplicates
- **ëª©ì **: ì¤‘ë³µ ì—…ë¬´ ê·¸ë£¹ ì¡°íšŒ
- **ì¸ì¦**: Bearer í† í° í•„ìš”
- **ë¡œì§**:
  1. `business_name`, `task_type`, `status` ì¡°í•©ìœ¼ë¡œ ê·¸ë£¹í•‘
  2. 2ê°œ ì´ìƒì¸ ê·¸ë£¹ë§Œ í•„í„°ë§
  3. ê° ê·¸ë£¹ì—ì„œ ìµœì‹  ì—…ë¬´(created_at ê¸°ì¤€) 1ê°œëŠ” ë³´ì¡´ í‘œì‹œ
  4. ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œ ëŒ€ìƒìœ¼ë¡œ í‘œì‹œ

**ì‘ë‹µ í˜•ì‹**:
```json
{
  "duplicates": [
    {
      "key": "ì‚¬ì—…ì¥ëª…|task_type|status",
      "business_name": "ì‚¬ì—…ì¥ëª…",
      "task_type": "dealer",
      "status": "dealer_product_ordered",
      "count": 3,
      "tasks": [
        {
          "id": "uuid",
          "title": "ì—…ë¬´ ì œëª©",
          "created_at": "2024-01-01T00:00:00Z",
          "assignee": "ë‹´ë‹¹ì",
          "due_date": "2024-12-31",
          "keep": true  // ë³´ì¡´ (ìµœì‹  ì—…ë¬´)
        },
        {
          "id": "uuid",
          "title": "ì—…ë¬´ ì œëª©",
          "created_at": "2023-12-01T00:00:00Z",
          "keep": false  // ì‚­ì œ ëŒ€ìƒ
        }
      ]
    }
  ],
  "summary": {
    "totalGroups": 1,
    "totalDuplicates": 3,
    "toDelete": 2
  }
}
```

#### DELETE /api/admin/tasks/duplicates
- **ëª©ì **: ì„ íƒí•œ ì¤‘ë³µ ì—…ë¬´ soft delete
- **ì¸ì¦**: Bearer í† í° í•„ìš”
- **ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "taskIds": ["uuid1", "uuid2", ...]
}
```

**ì‘ë‹µ í˜•ì‹**:
```json
{
  "success": 45,
  "failed": 2
}
```

### 2. UI ì»´í¬ë„ŒíŠ¸

#### DuplicateGroupCard (`components/admin/DuplicateGroupCard.tsx`)
- **ëª©ì **: ì¤‘ë³µ ê·¸ë£¹ í•˜ë‚˜ë¥¼ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œ
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ì‚¬ì—…ì¥ëª…, ì—…ë¬´ íƒ€ì…, ìƒíƒœ í‘œì‹œ
  - ë³´ì¡´ ì—…ë¬´ëŠ” ë…¹ìƒ‰ ë°°ê²½ + ì²´í¬ ì•„ì´ì½˜
  - ì‚­ì œ ëŒ€ìƒì€ ì²´í¬ë°•ìŠ¤ë¡œ ì„ íƒ ê°€ëŠ¥
  - ìƒì„±ì¼, ë‹´ë‹¹ì, ë§ˆê°ì¼ ì •ë³´ í‘œì‹œ

**UI êµ¬ì¡°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [1] ì‚¬ì—…ì¥ëª…  [íƒ€ì…ë±ƒì§€] [ìƒíƒœë±ƒì§€]    â”‚
â”‚ ì¤‘ë³µ ìˆ˜: 3ê°œ                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ âœ“ 1. ë³´ì¡´ - ì—…ë¬´ ì œëª©              â”‚  <- ë…¹ìƒ‰ ë°°ê²½
â”‚    ìƒì„±ì¼: 2024-01-01             â”‚
â”‚                                    â”‚
â”‚ â–¡ 2. ì‚­ì œ ëŒ€ìƒ - ì—…ë¬´ ì œëª©         â”‚  <- ì„ íƒ ê°€ëŠ¥
â”‚    ìƒì„±ì¼: 2023-12-01             â”‚
â”‚                                    â”‚
â”‚ â–¡ 3. ì‚­ì œ ëŒ€ìƒ - ì—…ë¬´ ì œëª©         â”‚
â”‚    ìƒì„±ì¼: 2023-11-01             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### DuplicateTasksModal (`components/admin/DuplicateTasksModal.tsx`)
- **ëª©ì **: ì¤‘ë³µ ì—…ë¬´ ê´€ë¦¬ ëª¨ë‹¬
- **ì£¼ìš” ê¸°ëŠ¥**:
  1. ëª¨ë‹¬ ì—´ë¦´ ë•Œ ìë™ìœ¼ë¡œ ì‚­ì œ ëŒ€ìƒ ì„ íƒ
  2. ì „ì²´ ì„ íƒ/í•´ì œ ë²„íŠ¼
  3. ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
  4. Soft delete ì•ˆë‚´ ë©”ì‹œì§€
  5. ì‚­ì œ ì§„í–‰ ìƒíƒœ í‘œì‹œ

**ëª¨ë‹¬ êµ¬ì¡°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ—‘ï¸ ì¤‘ë³µ ì—…ë¬´ ê´€ë¦¬                    âœ•  â”‚
â”‚ ì¤‘ë³µ ê·¸ë£¹: 5ê°œ | ì „ì²´ ì¤‘ë³µ: 15ê°œ           â”‚
â”‚ ì‚­ì œ ëŒ€ìƒ: 10ê°œ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ ì¤‘ë³µ ì—…ë¬´ ì‚­ì œ ì•ˆë‚´                    â”‚
â”‚ â€¢ ê°€ì¥ ìµœê·¼ ì—…ë¬´ëŠ” ìë™ ë³´ì¡´              â”‚
â”‚ â€¢ Soft Delete ë°©ì‹ (ë³µêµ¬ ê°€ëŠ¥)          â”‚
â”‚ â€¢ ì‚­ì œ í›„ ìë™ ìƒˆë¡œê³ ì¹¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ì¤‘ë³µ ê·¸ë£¹ ì¹´ë“œë“¤...]                    â”‚ <- ìŠ¤í¬ë¡¤
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì „ì²´ ì„ íƒ | ì „ì²´ í•´ì œ                     â”‚
â”‚                     [ì·¨ì†Œ] [10ê°œ ì‚­ì œ] ğŸ—‘ï¸ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. admin/tasks í˜ì´ì§€ í†µí•©

#### ì¶”ê°€ëœ ìƒíƒœ ë³€ìˆ˜
```typescript
const [showDuplicateModal, setShowDuplicateModal] = useState(false)
const [duplicateGroups, setDuplicateGroups] = useState<any[]>([])
const [duplicateSummary, setDuplicateSummary] = useState({
  totalGroups: 0,
  totalDuplicates: 0,
  toDelete: 0
})
const [isDuplicateLoading, setIsDuplicateLoading] = useState(false)
```

#### ì¶”ê°€ëœ í•¨ìˆ˜
```typescript
// ì¤‘ë³µ ì—…ë¬´ ì¡°íšŒ
const fetchDuplicates = async () => { ... }

// ì¤‘ë³µ ì—…ë¬´ ì‚­ì œ
const deleteDuplicates = async (taskIds: string[]) => { ... }

// ëª¨ë‹¬ ì—´ê¸° í•¸ë“¤ëŸ¬
const handleOpenDuplicateModal = useCallback(async () => { ... }, [])
```

#### ì¶”ê°€ëœ UI ìš”ì†Œ

**í—¤ë” ë²„íŠ¼** (ê¶Œí•œ 4ë§Œ í‘œì‹œ):
```tsx
<button
  onClick={handleOpenDuplicateModal}
  className="flex items-center gap-2 bg-orange-600 text-white px-3 py-1.5 md:px-3 rounded-lg hover:bg-orange-700 transition-colors text-sm"
  title="ì¤‘ë³µ ì—…ë¬´ ì¡°íšŒ ë° ì‚­ì œ"
>
  <FileX className="w-4 h-4" />
  <span className="hidden md:inline">ì¤‘ë³µ ê´€ë¦¬</span>
</button>
```

**ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸**:
```tsx
<DuplicateTasksModal
  isOpen={showDuplicateModal}
  onClose={() => setShowDuplicateModal(false)}
  duplicates={duplicateGroups}
  summary={duplicateSummary}
  onDelete={deleteDuplicates}
/>
```

## ì‚¬ìš© íë¦„

1. **ê´€ë¦¬ì ë¡œê·¸ì¸**: permission_level === 4
2. **ë²„íŠ¼ í´ë¦­**: í—¤ë”ì˜ "ì¤‘ë³µ ê´€ë¦¬" ë²„íŠ¼ (ì£¼í™©ìƒ‰)
3. **ìë™ ì¡°íšŒ**:
   - API í˜¸ì¶œí•˜ì—¬ ì¤‘ë³µ ì—…ë¬´ ì¡°íšŒ
   - ì¤‘ë³µì´ ì—†ìœ¼ë©´ "ì¤‘ë³µëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤" ì•Œë¦¼
   - ì¤‘ë³µì´ ìˆìœ¼ë©´ ëª¨ë‹¬ í‘œì‹œ
4. **ê²€í† **:
   - ê° ê·¸ë£¹ë³„ ì¤‘ë³µ ì—…ë¬´ í™•ì¸
   - ì‚­ì œ ëŒ€ìƒì´ ìë™ìœ¼ë¡œ ì„ íƒë¨
   - í•„ìš”ì‹œ ì„ íƒ ì¡°ì • ê°€ëŠ¥
5. **ì‚­ì œ ì‹¤í–‰**:
   - "Nê°œ ì‚­ì œ" ë²„íŠ¼ í´ë¦­
   - í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
   - í™•ì¸ ì‹œ soft delete ì‹¤í–‰
   - ì„±ê³µ/ì‹¤íŒ¨ ê²°ê³¼ ì•Œë¦¼
   - ìë™ìœ¼ë¡œ ì—…ë¬´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨

## ê¸°ìˆ ì  íŠ¹ì§•

### ë³´ì•ˆ
- Bearer í† í° ì¸ì¦
- ê¶Œí•œ ë ˆë²¨ 4 ê²€ì¦ (UI + API ëª¨ë‘)
- Soft deleteë¡œ ë°ì´í„° ë³µêµ¬ ê°€ëŠ¥ì„± ë³´ì¥

### UX
- ìë™ ì‚­ì œ ëŒ€ìƒ ì„ íƒìœ¼ë¡œ ë¹ ë¥¸ ì‘ì—…
- ë³´ì¡´/ì‚­ì œ ëŒ€ìƒ ì‹œê°ì  êµ¬ë¶„ (ìƒ‰ìƒ)
- ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ë¡œ ì‹¤ìˆ˜ ë°©ì§€
- ë¡œë”© ìƒíƒœ í‘œì‹œ

### ì„±ëŠ¥
- ì¤‘ë³µ ì¡°íšŒëŠ” í•„ìš”í•  ë•Œë§Œ ì‹¤í–‰
- ì‚­ì œ í›„ ìë™ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€
- ëª¨ë‹¬ ë°©ì‹ìœ¼ë¡œ í˜ì´ì§€ ì´ë™ ì—†ìŒ

## íŒŒì¼ ëª©ë¡

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼
1. `app/api/admin/tasks/duplicates/route.ts` - API ì—”ë“œí¬ì¸íŠ¸
2. `components/admin/DuplicateGroupCard.tsx` - ê·¸ë£¹ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
3. `components/admin/DuplicateTasksModal.tsx` - ê´€ë¦¬ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸

### ìˆ˜ì •ëœ íŒŒì¼
1. `app/admin/tasks/page.tsx` - ë²„íŠ¼ ë° ëª¨ë‹¬ í†µí•©

## ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë™ í™•ì¸
  - [x] GET: ì¤‘ë³µ ê·¸ë£¹ ì˜¬ë°”ë¥´ê²Œ ì¡°íšŒ
  - [x] DELETE: soft delete ì •ìƒ ì‘ë™
- [x] UI ì»´í¬ë„ŒíŠ¸ ì‘ë™ í™•ì¸
  - [x] ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  - [x] ê·¸ë£¹ ì¹´ë“œ í‘œì‹œ
  - [x] ì²´í¬ë°•ìŠ¤ ì„ íƒ/í•´ì œ
  - [x] ì „ì²´ ì„ íƒ/í•´ì œ
- [x] í†µí•© ê¸°ëŠ¥ í™•ì¸
  - [x] ê¶Œí•œ 4ë§Œ ë²„íŠ¼ í‘œì‹œ
  - [x] ì¤‘ë³µ ì—†ì„ ë•Œ ì•Œë¦¼
  - [x] ì‚­ì œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  - [x] ì—ëŸ¬ í•¸ë“¤ë§

## ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

1. **ëª¨ë‹ˆí„°ë§**: ì¤‘ë³µ ë°œìƒ ë¹ˆë„ ì¶”ì 
2. **ì˜ˆë°©**: ì—‘ì…€ ì¼ê´„ ë“±ë¡ ë¡œì§ ê°œì„ ìœ¼ë¡œ ì¤‘ë³µ ì›ì²œ ì°¨ë‹¨
3. **ìë™í™”**: ì •ê¸°ì ì¸ ì¤‘ë³µ ì²´í¬ ìŠ¤ì¼€ì¤„ëŸ¬ ê³ ë ¤
4. **ë¡œê¹…**: ì‚­ì œ ì‘ì—… ê°ì‚¬ ë¡œê·¸ ì¶”ê°€

## ë³µêµ¬ ë°©ë²•

ì‚­ì œëœ ì—…ë¬´ëŠ” soft delete ë°©ì‹ì´ë¯€ë¡œ í•„ìš”ì‹œ ë³µêµ¬ ê°€ëŠ¥:

```sql
-- íŠ¹ì • ì—…ë¬´ ë³µêµ¬
UPDATE facility_tasks
SET is_deleted = false, updated_at = NOW()
WHERE id = 'task_id';

-- íŠ¹ì • ë‚ ì§œ ì´í›„ ì‚­ì œëœ ëª¨ë“  ì—…ë¬´ ë³µêµ¬
UPDATE facility_tasks
SET is_deleted = false, updated_at = NOW()
WHERE is_deleted = true
  AND updated_at > '2024-01-01';
```

## ì™„ë£Œ ì¼ì‹œ

- êµ¬í˜„ ì™„ë£Œ: 2024ë…„ (í˜„ì¬ ì„¸ì…˜)
- ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰: 47ê°œ ì¤‘ë³µ ì—…ë¬´ ì‚­ì œ ì™„ë£Œ
- UI í†µí•©: admin/tasks í˜ì´ì§€ì— ì™„ì „ í†µí•©
